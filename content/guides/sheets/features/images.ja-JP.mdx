---
title: 画像
icon: ImagePlus
---

<MetaData
  lang="ja-JP"
  meta={{
    preset: [{
      client: '@univerjs/preset-sheets-drawing',
      locale: '@univerjs/preset-sheets-drawing/locales/en-US',
      style: '@univerjs/preset-sheets-drawing/lib/index.css',
    }],
    plugins: [{
      client: '@univerjs/drawing',
    }, {
      client: '@univerjs/drawing-ui',
      locale: '@univerjs/drawing-ui/locale/en-US',
      style: '@univerjs/drawing-ui/lib/index.css',
    }, {
      client: '@univerjs/sheets-drawing',
    }, {
      client: '@univerjs/sheets-drawing-ui',
      facade: '@univerjs/sheets-drawing-ui/facade',
      locale: '@univerjs/sheets-drawing-ui/locale/en-US',
      style: '@univerjs/sheets-drawing-ui/lib/index.css',
    }],
    server: 'No',
  }}
/>

画像は、スプレッドシートのコンテンツを豊かにし、視覚的な表現を強化し、重要な情報を説明・強調するのに使用できます。

現在サポートされている画像の種類は、浮動画像（floating images）とセル内画像（cell images）です。

<PlaygroundFrame lang="ja-JP" slug="sheets/images" clickToShow />

## プリセットモード

### インストール

```package-install
npm install @univerjs/preset-sheets-drawing
```

### 使い方

```typescript
import { UniverSheetsCorePreset } from '@univerjs/preset-sheets-core'
import UniverPresetSheetsCoreEnUS from '@univerjs/preset-sheets-core/locales/en-US'
import { UniverSheetsDrawingPreset } from '@univerjs/preset-sheets-drawing' // [!code ++]
import UniverPresetSheetsDrawingEnUS from '@univerjs/preset-sheets-drawing/locales/en-US' // [!code ++]
import { createUniver, LocaleType, mergeLocales } from '@univerjs/presets'

import '@univerjs/preset-sheets-core/lib/index.css'
import '@univerjs/preset-sheets-drawing/lib/index.css' // [!code ++]

const { univerAPI } = createUniver({
  locale: LocaleType.En_US,
  locales: {
    [LocaleType.En_US]: mergeLocales(
      UniverPresetSheetsCoreEnUS,
      UniverPresetSheetsDrawingEnUS, // [!code ++]
    ),
  },
  presets: [
    UniverSheetsCorePreset(),
    UniverSheetsDrawingPreset(), // [!code ++]
  ],
})
```

コラボレーション機能（[collaboration](/guides/sheets/features/collaboration)）を使用する場合は、`UniverSheetsDrawingPreset` に `collaboration: true` オプションを渡してください:

```typescript
UniverSheetsDrawingPreset({
  collaboration: true, // [!code ++]
})
```

{/* ### Presets and Configuration */}

## プラグインモード

### インストール

```package-install
npm install @univerjs/docs-drawing @univerjs/drawing @univerjs/drawing-ui @univerjs/sheets-drawing @univerjs/sheets-drawing-ui
```

### 使い方

```typescript
import { LocaleType, mergeLocales, Univer } from '@univerjs/core'
import { UniverDocsDrawingPlugin } from '@univerjs/docs-drawing' // [!code ++]
import { IImageIoService, UniverDrawingPlugin } from '@univerjs/drawing' // [!code ++]
import { UniverDrawingUIPlugin } from '@univerjs/drawing-ui' // [!code ++]
import DrawingUIEnUS from '@univerjs/drawing-ui/locale/en-US' // [!code ++]
import { UniverSheetsDrawingPlugin } from '@univerjs/sheets-drawing' // [!code ++]
import { UniverSheetsDrawingUIPlugin } from '@univerjs/sheets-drawing-ui' // [!code ++]
import SheetsDrawingUIEnUS from '@univerjs/sheets-drawing-ui/locale/en-US' // [!code ++]

import '@univerjs/drawing-ui/lib/index.css' // [!code ++]
import '@univerjs/sheets-drawing-ui/lib/index.css' // [!code ++]

import '@univerjs/sheets-drawing-ui/facade' // [!code ++]

const univer = new Univer({
  locale: LocaleType.En_US,
  locales: {
    [LocaleType.En_US]: mergeLocales(
      DrawingUIEnUS, // [!code ++]
      SheetsDrawingUIEnUS, // [!code ++]
    ),
  },
})

univer.registerPlugin(UniverSheetsFilterPlugin) // [!code ++]
univer.registerPlugin(UniverSheetsFilterUIPlugin) // [!code ++]

univer.registerPlugin(UniverDrawingPlugin) // [!code ++]
univer.registerPlugin(UniverDrawingUIPlugin) // [!code ++]
univer.registerPlugin(UniverSheetsDrawingPlugin) // [!code ++]
univer.registerPlugin(UniverSheetsDrawingUIPlugin) // [!code ++]
```

コラボレーション機能([collaboration](/guides/docs/features/collaboration))を使用する場合は、`override` 設定を追加する必要があります:

```typescript
univer.registerPlugin(UniverDrawingPlugin, {
  override: [[IImageIoService, null]], // [!code ++]
})
```

{/* ### Plugins and Configuration */}

## Facade API

完全な Facade API の型定義は [FacadeAPI](https://reference.univer.ai/en-US) で確認できます。

### Floating DOM の追加

`FWorksheet.addFloatDomToPosition(layer)` メソッドは、指定した位置に浮動 DOM 要素を追加できます。

```tsx
const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet()

// コンポーネントは適切なタイミングで登録してください（例: Univer が読み込まれたとき）
// これは React コンポーネントです。Vue3 コンポーネントの場合、3 番目の引数は `{ framework: 'vue3' }` にしてください
univerAPI.registerComponent(
  'myFloatDom',
  ({ data }) => (
    <div style={{ width: '100%', height: '100%', background: '#fff', border: '1px solid #ccc', boxSizing: 'border-box' }}>
      ポップアップ内容:
      {' '}
      {data?.label}
    </div>
  ),
)

// 浮動 DOM を追加します
// disposable が null の場合、浮動 DOM の追加に失敗しています
const disposable = fWorksheet.addFloatDomToPosition({
  componentKey: 'myFloatDom',
  initPosition: {
    startX: 100,
    endX: 300,
    startY: 100,
    endY: 200,
  },

  // コンポーネントのデータ
  data: {
    label: 'hahah',
  },
})

// 2 秒後に浮動 DOM を削除します
setTimeout(() => {
  disposable?.dispose()
}, 2000)
```

`FWorksheet.addFloatDomToRange(range, layer, domLayout)` メソッドは、指定した範囲に浮動 DOM 要素を追加できます。

```tsx
const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet()

// 範囲ロード用コンポーネントを登録します
function RangeLoading() {
  const divStyle = {
    width: '100%',
    height: '100%',
    backgroundColor: '#fff',
    border: '1px solid #ccc',
    boxSizing: 'border-box' as const,
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    textAlign: 'center' as const,
    transformOrigin: 'top left',
  }

  return (
    <div style={divStyle}>
      読み込み中...
    </div>
  )
}
univerAPI.registerComponent('RangeLoading', RangeLoading)

// 範囲 A1:C3 を覆う範囲ロードコンポーネントを追加します
const fRange = fWorksheet.getRange('A1:C3')
const disposable = fWorksheet.addFloatDomToRange(fRange, { componentKey: 'RangeLoading' }, {}, 'myRangeLoading')

// 2 秒後に浮動 DOM を削除します
setTimeout(() => {
  disposable?.dispose()
}, 2000)

// 別の例 -------------------
// フロートボタンコンポーネントを登録します
function FloatButton() {
  const divStyle = {
    width: '100px',
    height: '30px',
    backgroundColor: '#fff',
    border: '1px solid #ccc',
    boxSizing: 'border-box' as const,
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    textAlign: 'center' as const,
    cursor: 'pointer',
  }

  const clickHandler = () => {
    console.warn('click')
  }

  return (
    <div style={divStyle} onClick={clickHandler}>
      フロートボタン
    </div>
  )
}
univerAPI.registerComponent('FloatButton', FloatButton)

// フロートボタンを範囲 A5:C7 に追加します。配置は A5 セルから開始、幅 100px、高さ 30px、マージンは範囲幅 / 高さ の 100% です
const fRange2 = fWorksheet.getRange('A5:C7')
const disposable2 = fWorksheet.addFloatDomToRange(
  fRange2,
  {
    componentKey: 'FloatButton',
  },
  {
    width: 100,
    height: 30,
    marginX: '100%', // 範囲幅に対するマージンの割合、またはピクセル指定
    marginY: '100%',
  },
  'myFloatButton',
)
```

`FWorksheet.addFloatDomToColumnHeader(column, layer, domPos)` メソッドは、指定した列見出しに浮動 DOM 要素を追加できます。

```tsx
const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet()

// フロートボタンコンポーネントを登録します
function FloatButton() {
  const divStyle = {
    width: '100px',
    height: '30px',
    backgroundColor: '#fff',
    border: '1px solid #ccc',
    boxSizing: 'border-box' as const,
    display: 'flex',
    justifyContent: 'center',
    alignItems: 'center',
    textAlign: 'center' as const,
    cursor: 'pointer',
  }

  const clickHandler = () => {
    console.warn('click')
  }

  return (
    <div style={divStyle} onClick={clickHandler}>
      フロートボタン
    </div>
  )
}
univerAPI.registerComponent('FloatButton', FloatButton)

// 列 D の見出しにフロートボタンを追加します。配置は右寄せ、幅 100px、高さ 30px、マージンは 0
const disposable = fWorksheet.addFloatDomToColumnHeader(
  3,
  {
    componentKey: 'FloatButton',
    allowTransform: false,
  },
  {
    width: 100,
    height: 30,
    marginX: 0,
    marginY: 0,
    horizonOffsetAlign: 'right',
  },
  'myFloatButton',
)

// 2 秒後にフロートボタンを削除します
setTimeout(() => {
  disposable?.dispose()
}, 2000)
```

### 浮動画像の挿入

[`FWorksheet.newOverGridImage()`](https://reference.univer.ai/en-US/classes/FWorksheet#newovergridimage) は浮動画像ビルダーを作成し、`FOverGridImageBuilder` のインスタンスを返します。チェーン呼び出しで `ISheetImage` オブジェクトを生成して画像を挿入できます。

以下は [`FOverGridImageBuilder`](https://reference.univer.ai/en-US/classes/FOverGridImageBuilder) の主なメソッドです:

| メソッド | 説明 |
| ------ | ----------- |
| buildAsync | 画像をビルドして `ISheetImage` オブジェクトを返します |
| setSource | 画像のソースを設定します |
| setColumn | 画像の水平位置を設定します |
| setRow | 画像の垂直位置を設定します |
| setColumnOffset | 画像の水平オフセットを設定します |
| setRowOffset | 画像の垂直オフセットを設定します |
| setWidth | 画像の幅を設定します |
| setHeight | 画像の高さを設定します |
| setAnchorType | 画像のアンカータイプを設定します（セルに応じて位置・サイズが変わるかどうか） |
| setCropTop | 画像の上端を定義して切り取り領域を設定します。表示したい画像の部分を指定できます |
| setCropLeft | 画像の左端を定義して切り取り領域を設定します。表示したい画像の部分を指定できます |
| setCropBottom | 画像の下端を定義して切り取り領域を設定します。表示したい画像の部分を指定できます |
| setCropRight | 画像の右端を定義して切り取り領域を設定します。表示したい画像の部分を指定できます |
| setRotate | 画像の回転角度を設定します |

```typescript
// 新しい画像ビルダーを作成し、画像ソースを設定します。
// その後 `ISheetImage` をビルドしてシートに挿入します。配置は F6 セルから開始、幅 500px、高さ 300px です
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()
const image = await fWorksheet.newOverGridImage()
  .setSource('https://avatars.githubusercontent.com/u/61444807?s=48&v=4', univerAPI.Enum.ImageSourceType.URL)
  .setColumn(5)
  .setRow(5)
  .setWidth(500)
  .setHeight(300)
  .buildAsync()
fWorksheet.insertImages([image])
```

`FWorksheet.insertImage(url, column, row, offsetX, offsetY)` メソッドでも画像を挿入できます。

```typescript
// 画像をシートに挿入します。配置は F6、オフセットは 10px です
const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet()
const result = await fWorksheet.insertImage('https://avatars.githubusercontent.com/u/61444807?s=48&v=4', 5, 5, 10, 10)
```

### 浮動画像の取得

`FWorksheet.getImages()` メソッドはワークシート内のすべての浮動画像を取得し、[`FOverGridImage[]`](https://reference.univer.ai/en-US/classes/FOverGridImage) の配列を返します。

```typescript
const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet()
const images = fWorksheet.getImages()
images.forEach((image) => {
  image.getId()
})
```

ID によって `FWorksheet.getImageById(id)` メソッドで浮動画像を取得することもできます。

### 浮動画像の更新

`FWorksheet.updateImages(sheetImages)` メソッドは、浮動画像の位置やサイズを更新できます。

```typescript
// 新しい画像ビルダーを作成し、画像ソースを設定します。
// その後 `ISheetImage` をビルドしてシートに挿入します。配置は F6 セルから開始、幅 500px、高さ 300px です
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()
const image = await fWorksheet.newOverGridImage()
  .setSource('https://avatars.githubusercontent.com/u/61444807?s=48&v=4', univerAPI.Enum.ImageSourceType.URL)
  .setColumn(5)
  .setRow(5)
  .setWidth(500)
  .setHeight(300)
  .buildAsync()
fWorksheet.insertImages([image])

// 4 秒後に画像の幅を 100px、高さを 50px に更新します
setTimeout(async () => {
  const imageBuilder = fWorksheet.getImageById(image.drawingId).toBuilder()
  const newImage = await imageBuilder.setWidth(100).setHeight(50).buildAsync()
  fWorksheet.updateImages([newImage])
}, 4000)
```

### 浮動画像の削除

`FWorksheet.deleteImages(sheetImages)` メソッドは浮動画像を削除できます。

```typescript
const fWorksheet = univerAPI.getActiveWorkbook().getActiveSheet()
const image = fWorksheet.getImages()[0]

// シートの最初の画像を削除します
fWorksheet.deleteImages([image])
```

### セル内画像の挿入

`FRange.insertCellImageAsync(file)` メソッドはセル内画像を挿入できます。

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// セル A10 に画像を挿入します
const fRange = fWorksheet.getRange('A10')
const result = await fRange.insertCellImageAsync('https://avatars.githubusercontent.com/u/61444807?s=48&v=4')
```
