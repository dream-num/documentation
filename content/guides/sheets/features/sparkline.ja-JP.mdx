---
title: スパークライン
icon: '#pro/Spline'
---

<MetaData
  lang="ja-JP"
  isPro
  meta={{
    preset: [{
      client: '@univerjs/preset-sheets-advanced',
      locale: '@univerjs/preset-sheets-advanced/locales/en-US',
      style: '@univerjs/preset-sheets-advanced/lib/index.css',
    }],
    plugins: [{
      client: '@univerjs-pro/sheets-sparkline',
      facade: '@univerjs-pro/sheets-sparkline/facade',
    }, {
      client: '@univerjs-pro/sheets-sparkline-ui',
      locale: '@univerjs-pro/sheets-sparkline-ui/locale/en-US',
      style: '@univerjs-pro/sheets-sparkline-ui/lib/index.css',
    }],
    server: 'No',
  }}
/>

スパークラインは、セル内に埋め込まれるコンパクトなインラインチャートで、データの傾向や主要な指標を視覚的に表現します。

## プリセットモード

スパークライン機能は `@univerjs/preset-sheets-advanced` プリセットに含まれています。

### インストール

<Callout>
  `@univerjs/preset-sheets-advanced` の `UniverSheetsAdvancedPreset` プリセットは実行時に `UniverSheetsDrawingPreset` プリセットに依存します。先に `@univerjs/preset-sheets-drawing` をインストールしてください。
</Callout>

```package-install
npm install @univerjs/preset-sheets-drawing @univerjs/preset-sheets-advanced
```

### 使い方

```typescript
import { UniverSheetsAdvancedPreset } from '@univerjs/preset-sheets-advanced' // [!code ++]
import UniverPresetSheetsAdvancedEnUS from '@univerjs/preset-sheets-advanced/locales/en-US' // [!code ++]
import { UniverSheetsCorePreset } from '@univerjs/preset-sheets-core'
import UniverPresetSheetsCoreEnUS from '@univerjs/preset-sheets-core/locales/en-US'
import { UniverSheetsDrawingPreset } from '@univerjs/preset-sheets-drawing' // [!code ++]
import UniverPresetSheetsDrawingEnUS from '@univerjs/preset-sheets-drawing/locales/en-US' // [!code ++]
import { createUniver, LocaleType, mergeLocales } from '@univerjs/presets'

import '@univerjs/preset-sheets-core/lib/index.css'
import '@univerjs/preset-sheets-drawing/lib/index.css' // [!code ++]
import '@univerjs/preset-sheets-advanced/lib/index.css' // [!code ++]

const { univerAPI } = createUniver({
  locale: LocaleType.En_US,
  locales: {
    [LocaleType.En_US]: mergeLocales(
      UniverPresetSheetsCoreEnUS,
      UniverPresetSheetsDrawingEnUS, // [!code ++]
      UniverPresetSheetsAdvancedEnUS, // [!code ++]
    ),
  },
  presets: [
    UniverSheetsCorePreset(),
    UniverSheetsDrawingPreset(), // [!code ++]
    UniverSheetsAdvancedPreset(), // [!code ++]
  ],
})
```

Univer に商用ライセンスをお持ちの場合は、設定方法については [クライアントでのライセンスの使用](/guides/pro/license#in-preset-mode) を参照してください。

{/* ### プリセットと設定 */}

## プラグインモード

### インストール

```package-install
npm install @univerjs-pro/sheets-sparkline @univerjs-pro/sheets-sparkline-ui
```

### 使い方

```typescript
import { UniverSheetSparklinePlugin } from '@univerjs-pro/sheets-sparkline' // [!code ++]
import { UniverSheetSparklineUIPlugin } from '@univerjs-pro/sheets-sparkline-ui' // [!code ++]
import SheetsSparklineUIEnUS from '@univerjs-pro/sheets-sparkline-ui/locale/en-US' // [!code ++]
import { LocaleType, mergeLocales, Univer } from '@univerjs/core'

import '@univerjs-pro/sheets-sparkline/facade' // [!code ++]

import '@univerjs-pro/sheets-sparkline-ui/lib/index.css' // [!code ++]

const univer = new Univer({
  locale: LocaleType.En_US,
  locales: {
    [LocaleType.En_US]: mergeLocales(
      SheetsSparklineUIEnUS, // [!code ++]
    ),
  },
})

univer.registerPlugin(UniverSheetSparklinePlugin)
univer.registerPlugin(UniverSheetSparklineUIPlugin)
```

Univer に商用ライセンスをお持ちの場合は、設定方法については [クライアントでのライセンスの使用](/guides/pro/license#in-plugin-mode) を参照してください。

## Facade API

### スパークラインの追加

[`FWorksheet.addSparkline`](https://reference.univer.ai/en-US/classes/FWorksheet#addsparkline) メソッドは、指定した範囲にスパークラインを追加し、`FSparkline` インスタンスを返します。

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// スパークラインを A1:A7 からデータソースとして作成し、セル A10 に配置します。
const sourceRanges = [fWorksheet.getRange('A1:A7').getRange()]
const targetRanges = [fWorksheet.getRange('A10').getRange()]
const sparkline = fWorksheet.addSparkline(sourceRanges, targetRanges, univerAPI.Enum.SparklineTypeEnum.LINE_CHART)
```

### スパークラインの合成と分解

[`FWorksheet.composeSparkline`](https://reference.univer.ai/en-US/classes/FWorksheet#composesparkline) と [`FWorksheet.unComposeSparkline`](https://reference.univer.ai/en-US/classes/FWorksheet#uncomposesparkline) メソッドは、スパークラインの合成および分解に使用されます。

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// スパークラインを A1:A7 からデータソースとして作成し、セル A10 に配置します。
const firstSparkline = fWorksheet.addSparkline(
  [fWorksheet.getRange('A1:A7').getRange()],
  [fWorksheet.getRange('A10').getRange()],
)

// スパークラインを B1:B7 からデータソースとして作成し、セル B10 に配置します。
const secondSparkline = fWorksheet.addSparkline(
  [fWorksheet.getRange('B1:B7').getRange()],
  [fWorksheet.getRange('B10').getRange()],
)

// スパークラインをグループ化します。
fWorksheet.composeSparkline([fWorksheet.getRange('A10:B10').getRange()])
console.log(fWorksheet.getAllSubSparkline().size) // 1

// 3 秒後にスパークラインを分解します。
setTimeout(() => {
  fWorksheet.unComposeSparkline([fWorksheet.getRange('A10:B10').getRange()])
  console.log(fWorksheet.getAllSubSparkline().size) // 2
}, 3000)
```

### スパークラインおよびスパークライングループの取得

[`FWorksheet.getSparklineByCell`](https://reference.univer.ai/en-US/classes/FWorksheet#getsparklinebycell) は、指定したセルのスパークラインインスタンスを取得し、`FSparkline` インスタンスを返します。

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// スパークラインを A1:A7 からデータソースとして作成し、セル A10 に配置します。
const sourceRanges = [fWorksheet.getRange('A1:A7').getRange()]
const targetRanges = [fWorksheet.getRange('A10').getRange()]
const sparkline = fWorksheet.addSparkline(sourceRanges, targetRanges)

console.log('Cell A10: ', fWorksheet.getSparklineByCell(9, 0))
console.log('Cell A11: ', fWorksheet.getSparklineByCell(10, 0))
```

[`FWorksheet.getSparklineGroupByCell`](https://reference.univer.ai/en-US/classes/FWorksheet#getsparklinegroupbycell) は、指定したセルのスパークライングループインスタンスを取得し、`FSparklineGroup` インスタンスを返します。

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// スパークラインを A1:A7 からデータソースとして作成し、セル A10 に配置します。
const firstSparkline = fWorksheet.addSparkline(
  [fWorksheet.getRange('A1:A7').getRange()],
  [fWorksheet.getRange('A10').getRange()],
)

// スパークラインを B1:B7 からデータソースとして作成し、セル B10 に配置します。
const secondSparkline = fWorksheet.addSparkline(
  [fWorksheet.getRange('B1:B7').getRange()],
  [fWorksheet.getRange('B10').getRange()],
)
console.log('Cell A10: ', fWorksheet.getSparklineGroupByCell(9, 0))

// 3 秒後にスパークラインを分解します。
setTimeout(() => {
  fWorksheet.composeSparkline([fWorksheet.getRange('A10:B10').getRange()])
  console.log('Cell A10: ', fWorksheet.getSparklineGroupByCell(9, 0))
}, 3000)
```

[`FSparkline`](https://reference.univer.ai/en-US/classes/FSparkline) インスタンスは、スパークラインを操作する次のメソッドを持ちます:

| Method | Description |
| --- | --- |
| changeDataSource | 現在のセル内のスパークラインのデータソースと配置を変更します
| removeSparkline | 現在のセル内のスパークラインを削除します |

[`FSparklineGroup`](https://reference.univer.ai/en-US/classes/FSparklineGroup) インスタンスは、スパークライングループを操作する次のメソッドを持ちます:

| Method | Description |
| --- | --- |
| changeDataSource | 現在のセル内のスパークライングループのデータソースと配置を変更します
| removeSparklineGroup | 現在のセル内のスパークライングループを削除します
| setConfig | 現在のセル内のスパークライングループの構成を変更します |

### イベントリスナー

完全なイベント型定義は、[Events](https://reference.univer.ai/en-US/classes/FEventName) で確認できます。

`univerAPI.Event.SheetSparklineChanged` イベントは、スパークラインが変更されたときに発火します。

```typescript
const disposable = univerAPI.addEvent(univerAPI.Event.SheetSparklineChanged, (params) => {
  const { workbook, worksheet, sparklines } = params
})

// イベントリスナーを削除するには、`disposable.dispose()` を使用します。
```
