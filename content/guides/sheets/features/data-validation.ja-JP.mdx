---
title: データ検証
icon: Grid2x2Check
---

<MetaData
  lang="ja-JP"
  meta={{
    preset: [{
      client: '@univerjs/preset-sheets-data-validation',
      locale: '@univerjs/preset-sheets-data-validation/locales/en-US',
      style: '@univerjs/preset-sheets-data-validation/lib/index.css',
    }],
    plugins: [{
      client: '@univerjs/data-validation',
    }, {
      client: '@univerjs/sheets-data-validation',
      facade: '@univerjs/sheets-data-validation/facade',
    }, {
      client: '@univerjs/sheets-data-validation-ui',
      locale: '@univerjs/sheets-data-validation-ui/locale/en-US',
      style: '@univerjs/sheets-data-validation-ui/lib/index.css',
    }],
    server: 'No',
  }}
/> 

データ検証は、セルにルールを設定して入力されたデータが特定の要件を満たすことを保証する機能です。入力エラーを防ぎ、データの正確性や一貫性を向上させます。

現在、次のデータ検証タイプがサポートされています:
- Number
- Integer
- Text length
- Date
- Checkbox
- Dropdown list (single/multiple selection)
- Custom formula

## プリセットモード

### インストール

```package-install
npm install @univerjs/preset-sheets-data-validation
```

### 使い方

```typescript
import { UniverSheetsCorePreset } from '@univerjs/preset-sheets-core'
import UniverPresetSheetsCoreEnUS from '@univerjs/preset-sheets-core/locales/en-US'
import { UniverSheetsDataValidationPreset } from '@univerjs/preset-sheets-data-validation' // [!code ++]
import UniverPresetSheetsDataValidationEnUS from '@univerjs/preset-sheets-data-validation/locales/en-US' // [!code ++]
import { createUniver, LocaleType, mergeLocales } from '@univerjs/presets'

import '@univerjs/preset-sheets-core/lib/index.css'
import '@univerjs/preset-sheets-data-validation/lib/index.css' // [!code ++]

const { univerAPI } = createUniver({
  locale: LocaleType.En_US,
  locales: {
    [LocaleType.En_US]: mergeLocales(
      UniverPresetSheetsCoreEnUS,
      UniverPresetSheetsDataValidationEnUS, // [!code ++]
    ),
  },
  presets: [
    UniverSheetsCorePreset(),
    UniverSheetsDataValidationPreset(), // [!code ++]
  ],
})
```

### プリセットと設定

```typescript
UniverSheetsDataValidationPreset({
  // ドロップダウンメニューに編集ボタンを表示するかどうか
  showEditOnDropdown: true,
})
```

{/* 完整的配置项参考 [`IUniverSheetsDataValidationPresetConfig`](https://github.com/dream-num/univer-presets/blob/dev/packages/preset-sheets-data-validation/src/umd.ts#L13)。 */}
Complete configuration options can be found in the [`IUniverSheetsDataValidationPresetConfig`](https://github.com/dream-num/univer-presets/blob/dev/packages/preset-sheets-data-validation/src/umd.ts#L13).

## プラグインモード

### インストール

```package-install
npm install @univerjs/data-validation @univerjs/sheets-data-validation @univerjs/sheets-data-validation-ui
```

### 使い方

```typescript
import { LocaleType, mergeLocales, Univer } from '@univerjs/core'
import { UniverDataValidationPlugin } from '@univerjs/data-validation' // [!code ++]
import { UniverSheetsDataValidationPlugin } from '@univerjs/sheets-data-validation' // [!code ++]
import { UniverSheetsDataValidationUIPlugin } from '@univerjs/sheets-data-validation-ui' // [!code ++]
import SheetsDataValidationEnUS from '@univerjs/sheets-data-validation-ui/locale/en-US' // [!code ++]

import '@univerjs/sheets-data-validation-ui/lib/index.css' // [!code ++]

import '@univerjs/sheets-data-validation/facade' // [!code ++]

const univer = new Univer({
  locale: LocaleType.En_US,
  locales: {
    [LocaleType.En_US]: mergeLocales(
      SheetsDataValidationEnUS, // [!code ++]
    ),
  },
})

univer.registerPlugin(UniverDataValidationPlugin) // [!code ++]
univer.registerPlugin(UniverSheetsDataValidationPlugin) // [!code ++]
univer.registerPlugin(UniverSheetsDataValidationUIPlugin) // [!code ++]
```

### プラグインと設定

```typescript
univer.registerPlugin(UniverSheetsDataValidationUIPlugin, {
  // Whether to display the edit button in the drop-down menu
  showEditOnDropdown: true,
})
```

{/* 完整的配置项参考 [IUniverSheetsDataValidationUIConfig](https://github.com/dream-num/univer/blob/dev/packages/sheets-data-validation-ui/src/controllers/config.schema.ts#L23)。 */}
Complete configuration options can be found in the [`IUniverSheetsDataValidationUIConfig`](https://github.com/dream-num/univer/blob/dev/packages/sheets-data-validation-ui/src/controllers/config.schema.ts#L23).

## Facade API

Facade API の完全な型定義は、[FacadeAPI](https://reference.univer.ai/en-US) で確認できます。

### データ検証ルールの追加

[`univerAPI.newDataValidation()`](https://reference.univer.ai/en-US/classes/FUniver#newdatavalidation) は、新しいデータ検証ビルダーを作成します。これは `FDataValidationBuilder` インスタンスを返し、チェーン呼び出しでデータ検証ルールを生成できます。

以下は [`FDataValidationBuilder`](https://reference.univer.ai/en-US/classes/FDataValidationBuilder) のメソッドの一部です:

| Method | Description |
| ------ | ----------- |
| build | データ検証ルールを構築します |
| requireCheckbox | 入力が boolean 値であることを要求するルールを設定します（チェックボックスとして表示されます） |
| requireDateAfter | データ検証タイプを DATE に設定し、指定日より後の日付を要求するルールを設定します |
| requireDateBefore | データ検証タイプを DATE に設定し、指定日より前の日付を要求するルールを設定します |
| requireDateBetween | データ検証タイプを DATE に設定し、特定の期間内の日付を要求するルールを設定します |
| requireDateEqualTo | データ検証タイプを DATE に設定し、指定日と等しいことを要求するルールを設定します |
| requireDateNotBetween | データ検証タイプを DATE に設定し、特定の期間内でないことを要求するルールを設定します |
| requireDateOnOrAfter | データ検証タイプを DATE に設定し、指定日以降の日付を要求するルールを設定します |
| requireDateOnOrBefore | データ検証タイプを DATE に設定し、指定日以前の日付を要求するルールを設定します |
| requireFormulaSatisfied | 与えられた数式が `true` と評価されることを要求するルールを設定します |
| requireNumberBetween | 指定した 2 つの数値の間、またはどちらかに等しい数値を要求するルールを設定します |
| requireNumberEqualTo | 指定した値と等しい数値を要求するルールを設定します |
| requireNumberGreaterThan | 指定した値より大きい数値を要求するルールを設定します |
| requireNumberGreaterThanOrEqualTo | 指定した値以上の数値を要求するルールを設定します |
| requireNumberLessThan | 指定した値より小さい数値を要求するルールを設定します |
| requireNumberLessThanOrEqualTo | 指定した値以下の数値を要求するルールを設定します |
| requireNumberNotBetween | 指定した 2 つの数値の間にない、かつどちらとも等しくない数値を要求するルールを設定します |
| requireNumberNotEqualTo | 指定した値と等しくない数値を要求するルールを設定します |
| requireValueInList | ユーザーが特定の値のリストから値を入力することを要求するルールを設定します |
| requireValueInRange | 指定した範囲内の値を入力することを要求するルールを設定します |
| setOptions | データ検証ルールのオプションを設定します |

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// 範囲 A1:B10 に対して 1 から 10 の数値を要求する新しいデータ検証ルールを作成します。
const fRange = fWorksheet.getRange('A1:B10')
const rule = univerAPI.newDataValidation()
  .requireNumberBetween(1, 10)
  .setOptions({
    allowBlank: true,
    showErrorMessage: true,
    error: 'Please enter a number between 1 and 10',
  })
  .build()
fRange.setDataValidation(rule)
```

### 範囲のデータ検証をクリア

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// 範囲 A1:B10 のデータ検証をクリアします
const fRange = fWorksheet.getRange('A1:B10')
fRange.setDataValidation(null)
```

### 範囲 / ワークシート のデータ検証の取得

返されるデータ検証ルールオブジェクトは `FDataValidation` インスタンスであり、ルールの条件やオプションなどを取得できます。

以下は [`FDataValidation`](https://reference.univer.ai/en-US/classes/FDataValidation) のメソッドの一部です:

| Method | Description |
| ---- | ---- |
| getCriteriaType | ルールのデータ検証タイプを取得します |
| getCriteriaValues | 条件評価に使用される値を取得します |
| getHelpText | ヘルプテキスト情報を取得します（ユーザーへの案内に使用されます） |
| getRanges | データ検証ルールが適用されている範囲を取得します |
| setCriteria | データ検証ルールの条件を設定します |
| setOptions | データ検証ルールのオプションを設定します |
| setRanges | データ検証ルールの対象範囲を設定します |
| delete | ワークシートからデータ検証ルールを削除します |

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// 現在のシートのすべてのデータ検証ルールを取得します
const rulesOfSheet = fWorksheet.getDataValidations()

const fRange = fWorksheet.getRange('A1:B10')

// 現在の範囲の最初のデータ検証ルールを取得します
const ruleOfRange = fRange.getDataValidation()
console.log('ruleOfRange:', ruleOfRange, ruleOfRange?.getCriteriaValues())

// 現在の範囲のすべてのデータ検証ルールを取得します
const rulesOfRange = fRange.getDataValidations()
```

### データ検証の更新 / 削除

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// 範囲 A1:B10 に対して 20 と等しい値を要求する新しいデータ検証ルールを作成します
const fRange = fWorksheet.getRange('A1:B10')
const rule = univerAPI.newDataValidation()
  .requireNumberEqualTo(20)
  .build()
fRange.setDataValidation(rule)

const newRuleRange = fWorksheet.getRange('C1:D10')

// 3 秒後にルールを更新します
setTimeout(() => {
  fRange.getDataValidation()
    // 範囲を C1:D10 に変更します
    .setRanges([newRuleRange])
    // 条件を 1 から 10 の数値を要求するように変更します
    .setCriteria(
      univerAPI.Enum.DataValidationType.DECIMAL,
      [univerAPI.Enum.DataValidationOperator.BETWEEN, '1', '10'],
    )
    // バリデーションエラー時に入力を止め、エラーメッセージを表示するようにオプションを変更します
    .setOptions({
      allowBlank: true,
      showErrorMessage: true,
      error: 'Please enter a valid value',
      errorStyle: univerAPI.Enum.DataValidationErrorStyle.STOP,
    })
}, 3000)

// 6 秒後にルールを削除します
setTimeout(() => {
  newRuleRange.getDataValidation().delete()
}, 6000)
```

### バリデータの状態を取得

```typescript
const fWorkbook = univerAPI.getActiveWorkbook()
const fWorksheet = fWorkbook.getActiveSheet()

// ワークブックのデータ検証バリデータの状態を取得します
fWorkbook.getValidatorStatus().then((status) => {
  console.log('===statusOfWorkbook', status)
})

// シートのデータ検証バリデータの状態を取得します
fWorksheet.getValidatorStatusAsync().then((status) => {
})

// 範囲のデータ検証バリデータの状態を取得します
const fRange = fWorksheet.getRange('A1:B10')
fRange.getValidatorStatus().then((status) => {
  console.log('===tatusOfRange', status)
})
```

### イベントリスナー

完全なイベント型定義は、[Events](https://reference.univer.ai/en-US/classes/FEventName) を参照してください。

データ検証モジュールは、ルールの追加、更新、削除、バリデーション状態の変更を監視するための一連のイベントを提供します。すべてのイベントは `univerAPI.addEvent()` で購読できます。

#### ルール変更イベント

`univerAPI.Event.SheetDataValidationChanged`: ルール変更後に発火します

```typescript
const disposable = univerAPI.addEvent(univerAPI.Event.SheetDataValidationChanged, (params) => {
  const { origin, worksheet, workbook, changeType, oldRule, rule } = params
})

// イベントリスナーを削除するには `disposable.dispose()` を使用します
```

`univerAPI.Event.BeforeSheetDataValidationAdd`: ルール追加前に発火します

```typescript
const disposable = univerAPI.addEvent(univerAPI.Event.BeforeSheetDataValidationAdd, (params) => {
  const { worksheet, workbook, rule } = params

  // データ検証ルールの追加をキャンセルします
  params.cancel = true
})

// イベントリスナーを削除するには `disposable.dispose()` を使用します
```

`univerAPI.Event.BeforeSheetDataValidationDelete`: ルール削除前に発火します

```typescript
const disposable = univerAPI.addEvent(univerAPI.Event.BeforeSheetDataValidationDelete, (params) => {
  const { worksheet, workbook, ruleId, rule } = params

  // データ検証ルールの削除をキャンセルします
  params.cancel = true
})

// イベントリスナーを削除するには `disposable.dispose()` を使用します
```

`univerAPI.Event.BeforeSheetDataValidationDeleteAll`: すべてのルール削除前に発火します

```typescript
const disposable = univerAPI.addEvent(univerAPI.Event.BeforeSheetDataValidationDeleteAll, (params) => {
  const { worksheet, workbook, rules } = params

  // データ検証ルールの削除をキャンセルします
  params.cancel = true
})

// イベントリスナーを削除するには `disposable.dispose()` を使用します
```

#### ルール更新イベント

`univerAPI.Event.BeforeSheetDataValidationCriteriaUpdate`: ルール条件更新前に発火します

```typescript
const disposable = univerAPI.addEvent(univerAPI.Event.BeforeSheetDataValidationCriteriaUpdate, (params) => {
  const { worksheet, workbook, ruleId, rule, newCriteria } = params

  // データ検証ルールの条件更新をキャンセルします
  params.cancel = true
})

// イベントリスナーを削除するには `disposable.dispose()` を使用します
```

`univerAPI.Event.BeforeSheetDataValidationRangeUpdate`: ルール範囲更新前に発火します

```typescript
const disposable = univerAPI.addEvent(univerAPI.Event.BeforeSheetDataValidationRangeUpdate, (params) => {
  const { worksheet, workbook, ruleId, rule, newRanges } = params

  // データ検証ルールの範囲更新をキャンセルします
  params.cancel = true
})

// イベントリスナーを削除するには `disposable.dispose()` を使用します
```

`univerAPI.Event.BeforeSheetDataValidationOptionsUpdate`: ルールオプション更新前に発火します

```typescript
const disposable = univerAPI.addEvent(univerAPI.Event.BeforeSheetDataValidationOptionsUpdate, (params) => {
  const { worksheet, workbook, ruleId, rule, newOptions } = params

  // データ検証ルールのオプション更新をキャンセルします
  params.cancel = true
})

// イベントリスナーを削除するには `disposable.dispose()` を使用します
```

#### バリデーション状態イベント

`univerAPI.Event.SheetDataValidatorStatusChanged`: セルのバリデーション状態が変更されたときに発火します

```typescript
const disposable = univerAPI.addEvent(univerAPI.Event.SheetDataValidatorStatusChanged, (params) => {
  const { worksheet, workbook, row, column, status, rule } = params
})

// イベントリスナーを削除するには `disposable.dispose()` を使用します
```

各イベントは以下の共通パラメータを含みます:
- `workbook`: 現在のワークブックインスタンス
- `worksheet`: 現在のワークシートインスタンス

特有のパラメータ:
- `rule`: 関連するデータ検証ルールオブジェクト
- `ruleId`: データ検証ルールの一意の識別子
- `status`: バリデーション状態（`SheetDataValidatorStatusChanged` イベントのみ）
- `newCriteria`: 新しい検証条件（`BeforeSheetDataValidationCriteriaUpdate` イベントのみ）
- `newRanges`: 新しい検証範囲（`BeforeSheetDataValidationRangeUpdate` イベントのみ）
- `newOptions`: 新しい検証オプション（`BeforeSheetDataValidationOptionsUpdate` イベントのみ）

`Before` プレフィックスが付いたすべてのイベントコールバックは `params.cancel = true` を使用して対応する操作を防止できます。

### 変更リストのレンダーモード設定

```typescript
dataValidation.setOptions({
  // support TEXT, ARROW, CUSTOM
  // default is `CUSTOM`
  renderMode: univerAPI.Enum.DataValidationRenderMode.TEXT,
})
```
